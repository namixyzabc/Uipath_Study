

## 🔧 よくあるエラーと解決方法

### 1. Excelファイル読み込みエラー

#### ❌ 問題
Excelファイルにハイパーリンクが含まれていると、読み込みが失敗することがあります。

#### 🔍 原因
「ワークブック」配下の「範囲を読み込み」アクティビティは、ハイパーリンクの処理が苦手です。

#### ✅ 解決方法
```
「Excel」アクティビティパッケージの「範囲を読み込み」を使用する
```

**例：**
- ❌ 悪い例：ワークブック > 範囲を読み込み
- ✅ 良い例：Excel > 範囲を読み込み

---

### 2. 不要な一時ファイル取得エラー

#### ❌ 問題
フォルダからファイルを取得する際、「~$」で始まる不要な一時ファイルも含まれてしまい、後続の処理でエラーが発生します。

#### 🔍 原因
VB.Netの `System.IO.Directory.GetFiles()` メソッドは、Excelが自動生成する一時ファイルも取得対象としてしまいます。

#### ✅ 解決方法
条件分岐を使って一時ファイルを除外します。

**設定例：**
```vb
分岐条件：item.ToString.Contains("~$") = False
```

**フロー例：**
1. フォルダからファイル一覧を取得
2. 各ファイルに対して条件分岐
3. ファイル名に「~$」が含まれていない場合のみ処理実行

---

### 3. 画面遷移の待機エラー（RPAの先走り）

#### ❌ 問題
アプリケーションの画面が完全に読み込まれる前に、次の操作を実行してしまいエラーになります。

#### 🔍 原因（初心者向け詳細説明）
- **Webページ（IE）の場合**：「準備完了まで待機」が有効に働きます
- **デスクトップアプリの場合**：UiPathは技術的にはアプリが操作可能と判断しますが、実際にはまだ読み込み中（くるくるマークが表示されている状態など）のことがあります

#### ✅ 解決方法

**方法1：要素の待機設定を活用**
```
「要素を探す」アクティビティのプロパティで以下にチェック：
- ✅ アクティブ化を待つ
- ✅ 表示されるまで待つ
```

**方法2：適切な要素の選択**
- ❌ 悪い例：画面遷移前後で同じボタンを指定
- ✅ 良い例：遷移後にのみ表示される要素を指定

**実例：**
ログイン画面 → メイン画面への遷移時
- ❌ 悪い例：「OK」ボタン（両画面に存在する可能性）
- ✅ 良い例：メイン画面固有の「データ一覧」テーブル

---

### 4. 【番外編】無限停止エラー

#### ❌ 問題
「Excelアプリケーションスコープ」などの一部アクティビティで、エラーにもならずに永遠に処理が止まってしまいます。

#### 🔍 原因（システム面の詳細説明）
- これらのアクティビティには**タイムアウト設定がありません**
- Excelファイルが他のプロセスで使用中だったり、破損していたりすると、開こうとして永遠に待機状態になります
- 通常のエラーハンドリングでは検知できません

#### ✅ 解決方法：「並列」アクティビティの活用

**設定手順：**
1. 「並列」アクティビティを配置
2. **左側**：対象の処理（例：Excelアプリケーションスコープ）
3. **右側**：タイムアウト処理
   - 「待機」アクティビティ（例：30秒）
   - 「メッセージをログ」アクティビティ（エラーレベル）
4. 「並列」アクティビティの**「条件」プロパティを「True」**に設定

**動作の仕組み：**
- ✅ **正常時**：Excelが正常に開き、左側の処理が完了 → 並列全体が終了
- ⚠️ **異常時**：30秒経過後、右側のタイムアウト処理が完了 → エラーログ出力して並列全体が終了

---

## 🛠️ 開発のベストプラクティス

### ログ活用のコツ

#### 「メッセージをログ」アクティビティの効果的な使い方

**ログレベルの使い分け：**
- `Error`：エラー発生時（赤色で表示）
- `Warn`：警告時（黄色で表示）
- `Info`：一般情報（青色で表示）
- `Trace`：詳細デバッグ情報（グレーで表示）

**配置のコツ：**
```
処理の各段階でログを出力
例：
1. "処理開始：請求書データの取得"（Info）
2. "ファイル数：5件"（Info）
3. "警告：一時ファイルを除外しました"（Warn）
4. "エラー：ファイルが開けません"（Error）
```

---

