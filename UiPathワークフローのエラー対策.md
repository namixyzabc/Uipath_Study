# UiPathワークフローのエラー対策


## 🔍 主要なエラーと対策

### 1. Excelファイルが読み込めないエラー

#### 📋 現象
Excelファイルを開こうとすると、なぜかエラーになってしまう

#### 🔍 原因
- Excelファイル内にハイパーリンク（クリックすると他のページに飛ぶリンク）が含まれている
- 「ワークブック」カテゴリの「範囲を読み込み」アクティビティがこのリンクをうまく処理できない

#### ✅ 対策
**「Excel」カテゴリの「範囲を読み込み」アクティビティを使用する**

```
例：
❌ 悪い例：ワークブック > 範囲を読み込み
✅ 良い例：Excel > 範囲を読み込み
```

---

### 2. ファイルが正常に取得されないエラー

#### 📋 現象
フォルダ内のExcelファイルを取得しようとすると、変なファイルまで取得されてエラーになる

#### 🔍 原因
- `System.IO.Directory.GetFiles("フォルダ名")`というプログラムコードを使うと、「~$」で始まる一時ファイルも取得してしまう
- この一時ファイルは、Excelが作業中に自動で作る隠しファイルで、通常は処理対象ではない

#### ✅ 対策
**ファイル名に「~$」が含まれるファイルを除外する処理を追加**

```
例：
取得したファイル一覧から
❌ ~$売上データ.xlsx（一時ファイル）← これを除外
✅ 売上データ.xlsx（本来のファイル）← これだけ処理
```

---

### 3. 画面の遷移やアクティブ化になる前にRPAが先走るエラー

#### 📋 現象
ボタンをクリックした後、まだ次の画面が表示されていないのに、RPAが次の操作を始めてしまいエラーになる

#### 🔍 原因（システム面の詳細説明）
- **Webページの場合**：「準備完了まで待機」設定が有効に働き、ページの読み込みを待ってくれる
- **デスクトップアプリの場合**：アプリが独自の待機画面（くるくる表示、スプラッシュ画面など）を表示していても、UiPathがそれを認識できない
- **技術的な理由**：UiPathは「WindowsMessage」という仕組みでアプリの状態を確認するが、アプリ独自の待機状態は検知できない

#### ✅ 対策
1. **「要素を探す」アクティビティの設定を調整**
   - 「アクティブ化を待つ」にチェック
   - 「表示されるまで待つ」にチェック

2. **画面遷移前後で重複しない要素を指定**
```
例：
❌ 悪い例：画面1と画面2の両方にある「OK」ボタンを指定
✅ 良い例：画面2にしかない「データ一覧」タイトルを指定
```

---

### 4. 【番外編】停止し続けてしまうエラー（タイムアウトがないエラー）

#### 📋 現象
RPAが永遠に待機状態になり、エラーも出ずに止まったままになる

#### 🔍 原因
- 一部のアクティビティ（例：「Excelアプリケーションスコープ」）にはタイムアウト設定がない
- ファイルが開けない状況でも、エラーにならずに永遠に待ち続ける

#### ✅ 対策：「並列」アクティビティを使用した解決法

**設定手順：**
1. 「並列」アクティビティを配置
2. 左側：本来の処理（例：Excelアプリケーションスコープ）
3. 右側：「待機」アクティビティ（30秒）→「メッセージをログ」アクティビティ
4. 「並列」アクティビティの「条件」プロパティを「True」に設定

**動作の仕組み：**
```
正常時：Excelが開く → 左側の処理完了 → 全体終了
異常時：30秒経過 → 右側の処理完了 → エラーログ出力 → 全体終了
```

---

## 💡 開発のヒント

### ログの活用方法

**「メッセージをログ」アクティビティの効果的な使い方**

- **ログレベルの使い分け**
  - `Error`：赤色で表示、重要なエラー情報
  - `Warn`：黄色で表示、注意が必要な情報  
  - `Info`：青色で表示、一般的な処理状況

```
例：
処理開始時：Info「処理を開始します」
エラー発生時：Error「ファイルが見つかりません」
処理完了時：Info「処理が正常に完了しました」
```

---

