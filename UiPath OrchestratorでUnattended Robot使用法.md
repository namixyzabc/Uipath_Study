### Unattended Robotとは？

まず、Unattended Robotが何かを理解することが重要です。

*   **Attended Robot（有人ロボット）**: 人間のPC上で、人間の指示（例: ボタンをクリック）によって動作するロボット。人間のアシスタント役。
*   **Unattended Robot（無人ロボット）**: 専用のサーバーや仮想マシン（VM）上で、人間の操作なしに、スケジュールや特定の条件（トリガー）に基づいて完全に自動で動作するロボット。24時間365日の稼働が可能。

この解説では、この**Unattended Robot**を動かすための手順を説明します。



### 全体像：Unattended Robot実行までの5つのステップ

全体像を先に把握しましょう。大きく分けて、以下の5つのステップで設定が完了します。

1.  **【Studio】開発とパブリッシュ**: 自動化プロジェクトを作成し、Orchestratorにアップロードできる形（パッケージ）にする。
2.  **【Orchestrator】実行環境の準備**: ロボットが動く「場所（マシン）」と「実行者（アカウント）」をOrchestratorに登録する。
3.  **【ロボットマシン】Orchestratorへの接続**: ロボットをインストールしたPCをOrchestratorに接続する。
4.  **【Orchestrator】プロセスの設定**: アップロードしたパッケージを、どの環境で実行するかを定義する。
5.  **【Orchestrator】ジョブの実行**: 設定したプロセスを手動またはトリガーで実行する。



---

### 詳細な手順解説

それでは、各ステップを詳しく見ていきましょう。
（※最新のUiPath Cloud Orchestratorのモダンフォルダーを基準に解説します）

### ステップ1：【Studio】プロセスの開発とパブリッシュ

まず、自動化したい業務をUiPath Studioでワークフローとして作成します。

1.  **プロジェクトの作成**: UiPath Studioで新しいプロジェクトを作成し、自動化のロジックを実装します。
2.  **パブリッシュ**: プロジェクトが完成したら、リボンの「**パブリッシュ**」ボタンをクリックします。
    *   **パブリッシュ先**: 「**Orchestrator テナント プロセス フィード**」を選択します。
    *   **バージョン**: 必要に応じてバージョン番号を設定します。
    *   「**パブリッシュ**」をクリックすると、プロジェクトが `.nupkg` というパッケージ形式でOrchestratorにアップロードされます。

> **ポイント**: これで、自動化の「設計図」がOrchestratorに送られました。

---

### ステップ2：【Orchestrator】実行環境の準備

次に、Orchestrator側で「どこで」「誰が」ロボットを動かすのかを定義します。

#### 2-1. マシンの設定（どこで動かすか）

ロボットが実行される物理マシンまたは仮想マシンをOrchestratorに登録します。

1.  Orchestratorにログインし、左メニューの「**テナント**」をクリックします。
2.  「**マシン**」タブを開き、「**マシンを追加**」ボタンから「**マシン テンプレート**」を選択します。
3.  **テンプレート名**を入力します（例: `Unattended-VM-Template`）。
4.  **Unattended ランタイム**の数を設定します。これは、このテンプレートを使用するマシンで同時に実行できるUnattendedプロセスの最大数です。（通常は1でOK）
5.  「**プロビジョニング**」をクリックして作成します。
6.  作成後、テンプレート名の横にある「**その他アクション**」>「**マシンキーをコピー**」をクリックして、マシンキーを控えておきます。このキーはステップ3で使用します。

> **ポイント**: これでOrchestratorは「`Unattended-VM-Template`」という名前のPCが存在することを認識しました。

#### 2-2. ロボットアカウントの設定（誰が動かすか）

ロボットがWindowsにサインインして操作するためのアカウント情報を登録します。

1.  左メニューの「**テナント**」>「**ユーザー**」タブを開きます。
2.  「**ユーザーを招待**」または既存ユーザーの「**編集**」をクリックします。
3.  **ユーザー情報**を入力します。
4.  「**Attended Robot**」のトグルを**オフ**、「**Unattended Robot**」のトグルを**オン**にします。
5.  以下のUnattended Robot用の情報を正確に入力します。
    *   **ドメイン\ユーザー名**: ロボット実行用PCのWindowsユーザー名。
        *   コマンドプロンプトで `whoami` と入力すると確認できます。（例: `DESKTOP-ABC\UipathUser`）
    *   **パスワード**: 上記ユーザーのWindowsサインインパスワード。
    *   **Credential Store**: 通常は「Orchestrator Database」のままでOKです。
6.  **ロール**で「**Robot**」が割り当てられていることを確認し、保存します。

> **ポイント**: これで「どのWindowsアカウントでサインインして作業するか」をOrchestratorに教えました。これはUnattended Robotで最も重要な設定の一つです。

#### 2-3. フォルダーへの割り当て

作成した「マシン」と「アカウント」を、実際にプロセスが所属する「フォルダー」に関連付けます。

1.  左メニューから、プロセスを管理したい**フォルダー**（例: `Default` や `Shared`）を選択します。
2.  「**マシン**」タブを開き、「**マシン/テンプレートをフォルダーに割り当て**」をクリックし、先ほど作成したマシンテンプレート（`Unattended-VM-Template`）を選択して割り当てます。
3.  「**ユーザー**」タブを開き、「**ユーザーまたはグループを割り当て**」をクリックし、先ほど設定したロボットアカウントを選択し、適切なロール（例: `Robot`）を割り当てます。

> **ポイント**: これで、「このフォルダーでは、あのマシンとあのアカウントを使ってロボットを動かして良い」という許可設定が完了しました。

---

### ステップ3：【ロボットマシン】Orchestratorへの接続

ロボットを実行するPC（サーバーやVM）上で、UiPath Assistantを使いOrchestratorと接続します。

1.  ロボット実行用PCにサインインします。
2.  **UiPath Assistant**を起動します。
3.  右上のアイコンから「**環境設定**」を開きます。
4.  「**Orchestrator の設定**」タブを開きます。
5.  接続の種類で「**マシンキー**」を選択します。
6.  以下の情報を入力します。
    *   **Orchestrator URL**: お使いのOrchestratorのURL。（例: `https://cloud.uipath.com/YourOrg/YourTenant/`）
    *   **マシンキー**: ステップ2-1でコピーしたマシンキーを貼り付けます。
7.  「**接続**」をクリックします。ステータスが「**接続済み、ライセンス済み**」になれば成功です。

> **ポイント**: これで物理的なPCとOrchestratorがリンクされ、いつでもOrchestratorから指令を受け取れる状態になりました。

---

### ステップ4：【Orchestrator】プロセスの設定

Orchestratorにアップロードしたパッケージを実行可能な「プロセス」として登録します。

1.  Orchestratorで、先ほど設定した**フォルダー**を選択します。
2.  「**オートメーション**」タブ > 「**プロセス**」サブタブを開きます。
3.  「**追加**」ボタンをクリックします。
4.  **パッケージ名**: ステップ1でパブリッシュしたパッケージの名前がドロップダウンに表示されるので、選択します。
5.  **パッケージバージョン**: 実行したいバージョンを選択します（通常は最新）。
6.  **エントリポイント**: `Main.xaml` など、実行を開始するファイルを選択します。
7.  表示名などを確認し、「**作成**」をクリックします。

> **ポイント**: これで、単なる設計図（パッケージ）が、いつでも実行できる状態（プロセス）になりました。

---

### ステップ5：【Orchestrator】ジョブの実行

いよいよロボットを実行します。実行方法は主に3つあります。

#### A) 手動で今すぐ実行

テストなどで、すぐに実行したい場合に使います。

1.  「**プロセス**」の一覧画面で、実行したいプロセスの右側にある「**ジョブを開始**」ボタン（▶マーク）をクリックします。
2.  実行する**ユーザー**（ロボットアカウント）を選択します。
3.  「**開始**」をクリックします。
4.  「**ジョブ**」タブに移動すると、ロボットが「実行中」などのステータスで表示されます。

#### B) スケジュールで実行（時間トリガー）

「毎日午前9時に実行」のように、決まった時間に自動実行させます。これぞUnattended Robotの真骨頂です。

1.  フォルダー内の「**トリガー**」タブを開きます。
2.  「**新しいトリガーを追加**」ボタンから「**時間**」を選択します。
3.  **名前**: トリガーの名前を入力します（例: `日次レポート作成`）。
4.  **プロセス**: 実行したいプロセスを選択します。
5.  **タイムゾーン**と**実行時間**を設定します。（例: 毎日、9時00分）
6.  「**追加**」をクリックします。

> **ポイント**: これで設定した時間になると、Orchestratorが自動でロボットに実行命令を出します。

#### C) キューアイテムで実行（キュー・トリガー）

キューに新しいアイテムが追加されたことをきっかけに、ロボットを自動実行させます。

1.  「**トリガー**」タブで「**キュー**」を選択します。
2.  監視対象の**キュー**と、実行する**プロセス**を選択します。
3.  ロボットを起動する条件（例: キューに1個以上のアイテムがある場合）を設定します。

---

### トラブルシューティング：よくある問題

*   **ロボットが「利用不可(Unavailable)」になる**:
    *   ロボットPCの電源がオフ、またはネットワークに接続されていない。
    *   UiPath AssistantがOrchestratorに接続できていない。（ステータスを確認）
    *   ロボット実行用PCに、別のユーザーがサインインしている。
    *   リモートデスクトップ接続を最小化している。（特定の対策が必要です）
*   **サインインに失敗する**:
    *   Orchestratorに登録した「ドメイン\ユーザー名」または「パスワード」が間違っている。
*   **プロセスが見つからない**:
    *   正しいフォルダーでプロセスを作成していますか？
    *   ユーザーやマシンがそのフォルダーに割り当てられていますか？

---

